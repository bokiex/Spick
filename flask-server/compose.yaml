networks:
    spick:
        driver: bridge
        name: spick

services:
    #######################################
    # Rabbit MQ
    #######################################
    #rabbitmq:
    #    image: rabbitmq:3-management
    #    hostname: esd-rabbit
    #    restart: always
    #    ports:
    #        - "5672:5672"
    #        - "15672:15672"
    #    volumes:
    #        - ./rabbitmq.config:/etc/rabbitmq/rabbitmq.config
    #        - ./rabbitmq_definitions.json:/etc/rabbitmq/rabbitmq_definitions.json
    #    networks:
    #        - spick

    user_schedule-mysql:
        networks:
            - spick
        container_name: user_schedule-mysql
        build: ./simple_services/user_schedule/mysql
        env_file:
            - .env
        healthcheck:
            test: ["CMD", "mysqladmin", "ping", "-h", "localhost", "-u", "root", "-p root"]
            interval: 30s
            timeout: 5s
            retries: 10

    ###############################################
    # User_Schedule Microservice
    ###############################################
    user_schedule:
        container_name: user_schedule
        build:
            context: ./simple_services/user_schedule/
            dockerfile: Dockerfile
        networks:
            - spick
        env_file:
            - .env
        ports:
            - "8007:8007"
        restart: always
        depends_on:
            user_schedule-mysql:
                condition: service_healthy
